{% extends 'base.html' %}

{% block page_title %}{% if form.instance.id_estudiante %}Editar{% else %}Nuevo{% endif %} Estudiante - GesInfra Web{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="card shadow">
                <div class="card-header bg-primary text-white">
                    <h4 class="mb-0">
                        <i class="fas {% if form.instance.id_estudiante %}fa-edit{% else %}fa-user-plus{% endif %} me-2"></i>
                        {% if form.instance.id_estudiante %}Editar{% else %}Nuevo{% endif %} Estudiante
                    </h4>
                </div>
                
                <div class="card-body">
                    <form method="post" novalidate>
                        {% csrf_token %}
                        
                        <!-- DATOS PERSONALES -->
                        <div class="card mb-4 border-primary">
                            <div class="card-header bg-light">
                                <h5 class="mb-0 text-primary">
                                    <i class="fas fa-user me-2"></i>DATOS PERSONALES
                                </h5>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">Nombres Completos *</label>
                                        {{ form.nombres_completos }}
                                        {% if form.nombres_completos.errors %}
                                            <div class="text-danger small">{{ form.nombres_completos.errors }}</div>
                                        {% endif %}
                                    </div>
                                    
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">CÃ©dula *</label>
                                        {{ form.cedula }}
                                        {% if form.cedula.errors %}
                                            <div class="text-danger small">{{ form.cedula.errors }}</div>
                                        {% endif %}
                                    </div>
                                </div>
                                
                                <div class="row">
                                    <div class="col-md-4 mb-3">
                                        <label class="form-label">Fecha de Nacimiento *</label>
                                        {{ form.fecha_nacimiento }}
                                    </div>
                                    
                                    <div class="col-md-4 mb-3">
                                        <label class="form-label">Edad *</label>
                                        {{ form.edad }}
                                    </div>
                                    
                                    <div class="col-md-4 mb-3">
                                        <label class="form-label">Sexo *</label>
                                        <div class="d-flex">
                                            {% for radio in form.sexo %}
                                            <div class="form-check me-3">
                                                {{ radio.tag }}
                                                <label class="form-check-label" for="{{ radio.id_for_label }}">
                                                    {{ radio.choice_label }}
                                                </label>
                                            </div>
                                            {% endfor %}
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">Nacionalidad</label>
                                        {{ form.nacionalidad }}
                                    </div>
                                    
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">Lugar de Nacimiento</label>
                                        {{ form.lugar_nacimiento }}
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- DATOS ACADÃ‰MICOS -->
                        <div class="card mb-4 border-success">
                            <div class="card-header bg-light">
                                <h5 class="mb-0 text-success">
                                    <i class="fas fa-graduation-cap me-2"></i>DATOS ACADÃ‰MICOS ðŸ‘‰
                                </h5>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-4 mb-3">
                                        <label class="form-label">Grado *</label>
                                        {{ form.grado }}
                                        <small class="form-text text-muted">
                                            <strong>EGB Media:</strong> 5.Âº, 6.Âº, 7.Âº de EGB<br>
                                            <strong>ðŸ”¹ EGB Superior:</strong> 8.Âº, 9.Âº, 10.Âº de EGB
                                        </small>
                                    </div>
                                    
                                    <div class="col-md-4 mb-3">
                                        <label class="form-label">Paralelo *</label>
                                        {{ form.paralelo }}
                                        <small class="form-text text-muted">A, B, C, D, E</small>
                                    </div>
                                    
                                    <div class="col-md-4 mb-3">
                                        <label class="form-label">Jornada *</label>
                                        {{ form.jornada }}
                                        <small class="form-text text-muted">Matutina, Vespertina, Nocturna</small>
                                    </div>
                                </div>
                                
                                <div class="row">
                                    <div class="col-md-6">
                                        <label class="form-label">AÃ±o lectivo *</label>
                                        {{ form.anio_lectivo }}
                                        <small class="form-text text-muted">Ejemplo: 2024-2025</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="d-flex justify-content-between mt-4">
                            <a href="{% url 'calificaciones:lista_estudiantes' %}" class="btn btn-secondary">
                                <i class="fas fa-arrow-left me-2"></i>Cancelar
                            </a>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save me-2"></i>Guardar Estudiante
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .form-label {
        font-weight: 600;
        margin-bottom: 0.5rem;
    }
    
    select.form-control, input.form-control {
        border: 1px solid #ced4da;
        border-radius: 0.375rem;
        padding: 0.5rem 0.75rem;
    }
    
    .form-check-input {
        margin-right: 0.5rem;
    }
    
    .card {
        border-radius: 0.5rem;
        overflow: hidden;
    }
    
    .card-header {
        border-bottom: 1px solid rgba(0,0,0,.125);
    }
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Mostrar nivel educativo basado en el grado seleccionado
    const gradoSelect = document.getElementById('id_grado');
    const nivelInfo = document.createElement('div');
    nivelInfo.className = 'alert alert-info mt-2';
    
    if (gradoSelect) {
        function actualizarNivel() {
            const grado = gradoSelect.value;
            let nivel = '';
            
            if (grado.includes('5EGB') || grado.includes('6EGB') || grado.includes('7EGB')) {
                nivel = 'ðŸ”¹ EGB Media';
            } else if (grado.includes('8EGB') || grado.includes('9EGB') || grado.includes('10EGB')) {
                nivel = 'ðŸ”¹ EGB Superior';
            } else if (grado.includes('BGU')) {
                nivel = 'ðŸ”¹ Bachillerato';
            }
            
            if (nivel) {
                nivelInfo.innerHTML = `<strong>Nivel Educativo:</strong> ${nivel}`;
                gradoSelect.parentNode.appendChild(nivelInfo);
            } else {
                nivelInfo.remove();
            }
        }
        
        gradoSelect.addEventListener('change', actualizarNivel);
        actualizarNivel(); // Ejecutar al cargar
    }
});
</script>
{% endblock %}